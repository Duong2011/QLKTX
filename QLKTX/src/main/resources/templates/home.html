<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Home</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.css"
            rel="stylesheet"
    />
    <!-- Font Awesome -->
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
            rel="stylesheet"
    />
    <!-- Google Fonts -->
    <link
            href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"
            rel="stylesheet"
    />
    <link
            th:href="@{css/style.css}"
            rel="stylesheet"
    />
</head>
<body>

<header>
    <nav class="navbar navbar-expand-lg navbar-light fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="home">
                <i class='fas fa-building' style='font-size:40px;color:red'></i>
                Quản Lý Kí Túc Xá
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="home">Trang Chủ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="login">Đăng Kí Tài Khoản</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="billDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Thanh Toán Hóa Đơn
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><button class="dropdown-item" onclick="">Xem  hóa đơn </button></li>
                            <li><a class="dropdown-item" href="#">Xem hóa đơn diện nước</a></li>

                        </ul>
                    </li>
                </ul>
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-danger btn-rounded" type="submit">Search</button>
                </form>

                <ul class="navbar-nav">
                    <!-- Avatar -->
                    <li class="nav-item dropdown">
                        <a
                                class="nav-link dropdown-toggle d-flex align-items-center"
                                href="#"
                                id="navbarDropdownMenuLink"
                                role="button"
                                data-mdb-toggle="dropdown"
                                aria-expanded="false"
                        >
                            <img
                                    src="https://haycafe.vn/wp-content/uploads/2022/02/Avatar-trang-den-599x600.png"
                                    class="rounded-circle"
                                    height="30"
                                    alt="Portrait of a Woman"
                                    loading="lazy"
                            />
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                            <li>
                                <button class="dropdown-item" onclick="profile()">Xem thông tin</button>
                            </li>
                            <li>
                                <button class="dropdown-item" onclick="viewEditForm()">Chỉnh sửa</button>
                            </li>
                            <li>
                                <button class="dropdown-item" onclick="contract()" >Hợp đồng thuê phòng</button>
                            </li>
                            <li>
                                <button class="dropdown-item" onclick="viewReportForm()">Báo cáo sự số phòng</button>
                            </li>
                            <li>
                                <button class="dropdown-item" onclick="logout()" >Đăng xuất</button>
                            </li>


                        </ul>
                    </li>
                </ul>

            </div>
        </div>
    </nav>
</header>





<!-- Carousel wrapper -->
<div id="carouselDarkVariant" class="carousel slide carousel-fade carousel-dark" data-mdb-ride="carousel">
    <!-- Indicators -->
    <div class="carousel-indicators">
        <button
                data-mdb-target="#carouselDarkVariant"
                data-mdb-slide-to="0"
                class="active"
                aria-current="true"
                aria-label="Slide 1"
        ></button>
        <button
                data-mdb-target="#carouselDarkVariant"
                data-mdb-slide-to="1"
                aria-label="Slide 1"
        ></button>
        <button
                data-mdb-target="#carouselDarkVariant"
                data-mdb-slide-to="2"
                aria-label="Slide 1"
        ></button>
    </div>

    <!-- Inner -->
    <div class="carousel-inner">
        <!-- Single item -->
        <div class="carousel-item active">
            <img th:src="@{image/momoqc1.jpg}" class="d-block w-100" alt="Motorbike Smoke"/>

        </div>

        <!-- Single item -->
        <div class="carousel-item">
            <img th:src="@{image/momoqc2.jpg}" class="d-block w-100" alt="Mountaintop"/>

        </div>

        <!-- Single item -->
        <div class="carousel-item">
            <img th:src="@{image/momoqc3.jpg}" class="d-block w-100" alt="Woman Reading a Book"/>

        </div>
    </div>
    <!-- Inner -->

    <!-- Controls -->
    <button class="carousel-control-prev" type="button" data-mdb-target="#carouselDarkVariant" data-mdb-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-mdb-target="#carouselDarkVariant" data-mdb-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</div>
<!-- Carousel wrapper -->


<div class="content" id="content">
    <img th:src="@{image/momo2.jpg}" class="rounded mx-auto d-block" width="100%" alt="...">

</div>


<div id="SinhVienInfo"></div>

<div id="form"></div>

<div id="contractInfo"></div>

<div id="formReport"></div>

<footer th:replace="/layout :: footer"></footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
<script
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.4.0/mdb.min.js"
></script>

<script>
    const token = localStorage.getItem("token");

    function logout(){
        localStorage.removeItem("token");
        window.location.href="login";
    }

    function edit() {

        this.event.preventDefault();
        let data=JSON.stringify({
            sinhVienId:$('#sinhVienId').val(),
            maSinhVien:$('#maSinhVien').val(),
            cccd:$('#cccd').val(),
            hoTen:$('#hoTen').val(),
            soDienThoai:$('#soDienThoai').val(),
            diaChi:$('#diaChi').val(),
            gioiTinh: $('#gioiTinh').val(),
            ngaySinh:$('#ngaySinh').val(),
            email:$('#email').val(),
            trangThai: $('#trangThai').val(),
            soPhong:$('#soPhong').val()
        })
        console.log(data);
        $.ajax({
            url: "/api/edit",
            headers :{
                'Authorization': 'Bearer ' + token
            },
            type: "PUT",
            data: data,
            contentType: 'application/json',
            success: (response) => {
                console.log(response);
                alert("Chỉnh sửa thông tin thành công");
            },
            error: (e) => {
                console.log(e);
                alert("Chỉnh sửa thông tin thất bại");
            }

        });
    }
    function report() {
        this.event.preventDefault();
        let data=JSON.stringify({
            phongId:$('#phongId').val(),
            ngayBaoCao:$('#ngayBaoCao').val(),
            moTaSuCo:$('#moTaSuCo').val(),
            trangThaiXuLy:$('#trangThaiXuLy').val(),
        })
        console.log(data);
        $.ajax({
            url: "/api/report",
            headers :{
                'Authorization': 'Bearer ' + token
            },
            type: "POST",
            data: data,
            contentType: 'application/json',
            success: (response) => {
                console.log(response);
                alert("Báo cáo thành công");
            },
            error: (e) => {
                console.log(e);
                alert("Báo cáo thất bại");
            }

        });
    }



    function renderFormReport(room) {

        let temp = '<div class="container" id ="profile">\n' +
            '        <form action="">\n' +
            '            <div class="row mb-3"><h1 class="text-center">Báo cáo sự cố</h1>\n' +
            '            </div>\n' +
            '            <div class="row">\n' +
            '                <div class="col-sm-9">\n' +
            '                    <input type="hidden" id="phongId" name="phongId" class="form-control" value="' + room.phongId + '"   />\n' +
            '                </div>\n' +
            '            </div>\n' +
            '            <hr>\n' +


            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              <p class="mb-0">Ngày Báo Cáo</p>\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="text" id="ngayBaoCao" name="ngayBaoCao" class="form-control" />\n' +
            '              </div>\n' +
            '          </div>\n' +
            '          <hr>\n' +

            '            <div class="row">\n' +
            '                <div class="col-sm-3">\n' +
            '                <p class="mb-0">Mô tả sự cố</p>\n' +
            '                </div>\n' +
            '                <div class="col-sm-9">\n' +
            '                    <input type="text" id="moTaSuCo" name="moTaSuCo" class="form-control" />\n' +
            '                </div>\n' +
            '            </div>\n' +
            '            <hr>\n' +
            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              <p class="mb-0">Trạng thái sử lý</p>\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="text" id="trangThaiXuLy" name="trangThaiXuLy" class="form-control" />\n' +
            '              </div>\n' +
            '          </div>\n' +

            '            <div class="button-submit text-center mt-3">\n' +
            '                <button type="submit" style="background-color: #eba7da;" class="btn btn-rounded mt-3 " onclick="report()" >Báo Cáo</button>\n' +
            '            </div>\n' +
            '        </form>\n' +
            '    </div>'
        $("#formReport").html(temp);
    }

    function renderFormEdit(user) {

        let temp = '<div class="container" id ="profile">\n' +
            '        <form action="">\n' +
            '             <input type="hidden" id="sinhVienId" name="sinhVienId" value="' + user.sinhVienId + '" />\n' +
            '            <div class="row mb-3"><h1 class="text-center">Chỉnh sửa thông tin</h1>\n' +
            '            </div>\n' +
            '            <div class="row">\n' +
            '                <div class="col-sm-3">\n' +
            '                <p class="mb-0">Họ Tên :</p>\n' +
            '                </div>\n' +
            '                <div class="col-sm-9">\n' +
            '                    <input type="text" id="hoTen" name="hoTen" class="form-control" value="' + user.hoTen + '" />\n' +
            '                </div>\n' +
            '            </div>\n' +
            '            <hr>\n' +

            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              <p class="mb-0">Mã Sinh Viên</p>\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="text" id="maSinhVien" name="maSinhVien" class="form-control" value="' + user.maSinhVien + '"/>\n' +
            '              </div>\n' +
            '          </div>\n' +
            '          <hr>\n' +

            '            <div class="row">\n' +
            '                <div class="col-sm-3">\n' +
            '                <p class="mb-0">Căn cước công dân</p>\n' +
            '                </div>\n' +
            '                <div class="col-sm-9">\n' +
            '                    <input type="text" id="cccd" name="cccd" class="form-control" value="' + user.cccd + '"/>\n' +
            '                </div>\n' +
            '            </div>\n' +
            '            <hr>\n' +
            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              <p class="mb-0">Số điện thoại</p>\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="text" id="soDienThoai" name="soDienThoai" class="form-control" value="' + user.soDienThoai + '"/>\n' +
            '              </div>\n' +
            '          </div>\n' +

            '          <hr>\n' +
            '            <div class="row">\n' +
            '                <div class="col-sm-3">\n' +
            '                <p class="mb-0">Địa Chỉ</p>\n' +
            '                </div>\n' +
            '                <div class="col-sm-9">\n' +
            '                    <input type="text" id="diaChi" name="diaChi" class="form-control" value="' + user.diaChi + '"/>\n' +
            '                </div>\n' +
            '            </div>\n' +
            '            <hr>\n' +

            '            <div class="row">\n' +
            '                <div class="col-sm-3">\n' +
            '                <p class="mb-0">Ngày sinh</p>\n' +
            '                </div>\n' +
            '                <div class="col-sm-9">\n' +
            '                    <input type="text" id="ngaySinh" name="ngaySinh" class="form-control" value="' + user.ngaySinh + '"/>\n' +
            '                </div>\n' +
            '            </div>\n' +
            '            <hr>\n' +

            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              <p class="mb-0">Email</p>\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="text" id="email" name="email" class="form-control" value=" ' + user.email + ' "/>\n' +
            '              </div>\n' +
            '          </div>\n' +
            '          <hr>\n' +

            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              <p class="mb-0">Giới tính</p>\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="text" id="gioiTinh" name="gioiTinh" class="form-control" value=" ' + user.gioiTinh + ' "/>\n' +
            '              </div>\n' +
            '          </div>\n' +
            '          <hr>\n' +

            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="hidden" id="soPhong" name="soPhong" class="form-control" value=" ' + user.soPhong + ' "/>\n' +
            '              </div>\n' +
            '          </div>\n' +


            '            <div class="row">\n' +
            '              <div class="col-sm-3">\n' +
            '              </div>\n' +
            '              <div class="col-sm-9">\n' +
            '                  <input type="hidden" id="trangThai" name="trangThai" class="form-control" value=" ' + user.trangThai + ' "/>\n' +
            '              </div>\n' +
            '          </div>\n' +


            '            <div class="button-submit text-center mt-3">\n' +
            '                <button type="submit" style="background-color: #eba7da;" class="btn btn-rounded mt-3 " onclick="edit()" >Chỉnh sửa</button>\n' +
            '            </div>\n' +
            '        </form>\n' +
            '    </div>'
        $("#form").html(temp);
    }

    function viewEditForm() {
        $("#carouselDarkVariant").hide();
        $("#content").hide();
        $("#SinhVienInfo").hide();
        $("#form").show();
        $.ajax({
            url: "/api/profile",
            headers :{
                'Authorization': 'Bearer ' + token
            },
            type: "GET",
            dataType: "json",
            success: (response) => {
                console.log(response);
                renderFormEdit(response);
            },
            error: (e) => {
                console.log(e);
            }

        });
    }
    function viewReportForm() {
        $("#carouselDarkVariant").hide();
        $("#content").hide();
        $("#SinhVienInfo").hide();
        $("#form").hide();
        $("#formReport").show();

        $.ajax({
            url: "/api/room",
            headers :{
                'Authorization': 'Bearer ' + token
            },
            type: "GET",
            dataType: "json",
            success: (response) => {
                console.log(response);
                renderFormReport(response);
            },
            error: (e) => {
                console.log(e);
            }

        });
    }

    function renderSinhVienInfo(data) {
        let temp = '<div class="container mt-5" id ="profile">\n' +
            '    <div class="row mb-3"><h1 class="text-center">Thông tin Sinh Viên</h1>\n' +
            '    </div>\n' +
            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Họ và tên</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0" >' + data.hoTen + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +
            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Mã Sinh Viên</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.maSinhVien + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +
            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Số điện thoại</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.soDienThoai + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Giới tính</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.gioiTinh + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Địa Chỉ</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.diaChi + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Số Phòng</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.ngaySinh + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Căn Cước Công Dân</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.cccd + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Email</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.email + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Số Phòng</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + data.soPhong + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +


            '</div>';
        $("#SinhVienInfo").html(temp);
    }

    function profile() {
        // $("header").hide();
        $("#carouselDarkVariant").hide();
        $("#content").hide();
        $("#form").hide();
        $("#SinhVienInfo").show();
        $("#contractInfo").hide();
        $.ajax({
            url: "/api/profile",
            headers :{
                'Authorization': 'Bearer ' + token
            },
            type: "GET",
            dataType: "json",
            success: (response) => {
                console.log(response);
                renderSinhVienInfo(response);
            },
            error: (e) => {
                console.log(e);
            }

        });
    }
    function renderContractInfo(hopdong) {
        let temp = '<div class="container mt-5" id ="profile">\n' +
            '    <div class="row mb-3"><h1 class="text-center">Thông Tin Hợp Đồng</h1>\n' +
            '    </div>\n' +
            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Ngày lập</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0" >' + hopdong.ngayLap + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +
            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Ngày bắt đầu thuê</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + hopdong.ngayBatDauThue + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +
            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Ngày kết thúc thuê</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + hopdong.ngayKetThucThue + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Trạng thái</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + hopdong.trangthai + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +

            '    <div class="row">\n' +
            '        <div class="col-sm-3">\n' +
            '            <p class="mb-0">Tiền thu</p>\n' +
            '        </div>\n' +
            '        <div class="col-sm-9">\n' +
            '            <p class="text-muted mb-0"> ' + hopdong.tienthu + ' </p>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '    <hr>\n' +



            '</div>';
        $("#contractInfo").html(temp);
    }

    function contract() {
        // $("header").hide();
        $("#carouselDarkVariant").hide();
        $("#content").hide();
        $("#form").hide();
        $("#SinhVienInfo").hide();
        $("#contractInfo").show();
        $.ajax({
            url: "/api/contract",
            headers :{
                'Authorization': 'Bearer ' + token
            },
            type: "GET",
            dataType: "json",
            success: (response) => {
                console.log(response);
                renderContractInfo(response);
            },
            error: (e) => {
                console.log(e);
            }

        });
    }


</script>
</body>
</html>